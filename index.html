<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Visualização 3D com Speckle</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #viewer { width: 100%; height: 400px; border: 1px solid #ccc; }
    #output { margin-top: 10px; font-size: 18px; }
    input[type="text"] {
      width: 100%;
      font-size: 18px;
      padding: 5px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      font-size: 16px;
      padding: 8px 12px;
    }
  </style>
</head>
<body>
  <h2>Selecione um Objeto no Modelo 3D</h2>

  <!-- Iframe com parâmetros embed=true e interaction=true -->
  <iframe
    id="viewer"
    src="https://app.speckle.systems/projects/8f8ced29b4/models/f22627d137?embed=true&interaction=true"
    frameborder="0"
  ></iframe>

  <p>ID do Objeto Selecionado:</p>
  <input type="text" id="selectedId" readonly />

  <button onclick="enviarParaPlanilha()">Enviar para Planilha</button>

  <script>
    // Escuta as mensagens enviadas pelo iframe do Speckle
    window.addEventListener("message", function (event) {
      // Confirme que a mensagem vem do Speckle e contém seleção
      if (event.data?.speckle?.selectedObjects?.length > 0) {
        const ids = event.data.speckle.selectedObjects;
        // Coloca o primeiro ID selecionado na caixa de texto
        document.getElementById("selectedId").value = ids[0];
      }
    });

    // Função para enviar o ID selecionado para o Google Apps Script
    function enviarParaPlanilha() {
      const id = document.getElementById("selectedId").value;
      if (!id) {
        alert("Selecione um objeto primeiro.");
        return;
      }

      fetch("https://script.google.com/macros/s/AKfycbw1DBciGLZjDIADn7WnXKAtUB77_ZCDmfWM5B4ltuIpl3TeCbnuo-f0Uc07SzQdDhi9/exec", {
        method: "POST",
        body: JSON.stringify({ id }),
        headers: { "Content-Type": "application/json" },
      })
        .then((res) => res.text())
        .then((msg) => alert("Enviado com sucesso: " + msg))
        .catch((err) => alert("Erro ao enviar: " + err));
    }
  </script>
</body>
</html>
